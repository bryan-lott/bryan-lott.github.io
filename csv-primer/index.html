<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="#ffffff" name="theme-color" />
  <meta content="#da532c" name="msapplication-TileColor" />

  
  
  
  
  

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/galleria@1.6.1/dist/themes/folio/galleria.folio.min.css" integrity="sha384-+rY0QD+LRnTOquDMzGa9lXU6jIwdiQuwCJQ2cdcW0qeP/0UbjQCZlXnRsUMA+9pH" crossorigin="anonymous">
  

  

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.1/css/academicons.min.css" integrity="sha384-FIue+PI4SsI9XfHCz8dBLg33b0c1fMJgNU3X//L26FYbGnlSEfWmNT7zgWc2N9b6" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css" integrity="sha384-IJLmUY0f1ePPX6uSCJ9Bxik64/meJmjSYD7dHaJqTXXEBE4y+Oe9P2KBZa/z7p0Q" crossorigin="anonymous">
  <link href="https://bryan-lott.github.io/deep-thought.css" rel="stylesheet" />
  
  

  <title>
    
(import this) | CSV Primer

  </title>

  
  
  

  
</head>

<body class="has-background-white">
  <nav aria-label="section navigation" class="navbar is-light" role="navigation">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item is-size-5 has-text-weight-bold" href="https:&#x2F;&#x2F;bryan-lott.github.io&#x2F;">(import this)</a>
        <a aria-expanded="false" aria-label="menu" class="navbar-burger burger" data-target="navMenu" role="button">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div class="navbar-menu" id="navMenu">
        <div class="navbar-end has-text-centered">
          
          
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;bryan-lott.github.io&#x2F;">
            Home
          </a>
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;bryan-lott.github.io&#x2F;&#x2F;now">
            Now
          </a>
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;bryan-lott.github.io&#x2F;&#x2F;uses">
            Uses
          </a>
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;bryan-lott.github.io&#x2F;&#x2F;about">
            About
          </a>
          
          
          
          <a class="navbar-item" id="nav-search" title="Search" data-target="#search-modal">
            <span class="icon">
              <i class="fas fa-search"></i>
            </span>
          </a>
          <a class="navbar-item" id="dark-mode" title="Switch to dark theme">
            <span class="icon">
              <i class="fas fa-adjust"></i>
            </span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  
  

  
<section class="section">
  <div class="container">
    <div class="columns">
      <div class="column is-8 is-offset-2">
        <article class="box">
          <h1 class="title">
            CSV Primer
          </h1>
          <p class="subtitle"></p>
          <div class="columns is-multiline is-gapless">
            <div class="column is-8">
              
<span class="icon-text has-text-grey">
  <span class="icon">
    <i class="fas fa-user"></i>
  </span>
  <span>Bryan Lott published on</span>
  <span class="icon">
    <i class="far fa-calendar-alt"></i>
  </span>
  <span><time datetime="2020-01-10">January 10, 2020</time></span>
</span>

            </div>
            <div class="column is-4 has-text-right-desktop">
              
<span class="icon-text has-text-grey">
  <span class="icon">
    <i class="far fa-clock"></i>
  </span>
  <span>6 min,</span>
  <span class="icon">
    <i class="fas fa-pencil-alt"></i>
  </span>
  <span>1045 words</span>
</span>

            </div>
            <div class="column">
              
            </div>
            <div class="column has-text-right-desktop">
              
            </div>
          </div>
          <div class="content mt-2">
            <p>Parsing certain data formats can be more challenging than others.  One of the granddaddy's of challenging file formats is the humble CSV or &quot;comma separated value&quot; file (I've also heard &quot;character separated value&quot;).  The lack of a strong specification as well as adherance to a specification is what makes parsing these files particularly challenging at times.</p>
<p>Given the experiences I've had over the past few months parsing over 40 different source file formats, here's a few ways to not make your own (or other) developer's pull <em>all</em> their hair out.</p>
<p>For the record, I've seen all of these in the wild.</p>
<h2 id="one-record-per-row">One record per row</h2>
<p>Seriously.  There's a reason why I'm putting this first.  I don't care if the row has 2 columns or 500, but if you're spreading records over multiple rows, everyone involved is going to have a bad time.</p>
<p>Bad:</p>
<pre data-lang="csv" class="language-csv "><code class="language-csv" data-lang="csv">id,title,image,image_position
1,dining room table,image1,1
1,,image2,3
1,,image3,2
</code></pre>
<p>Better:</p>
<pre data-lang="csv" class="language-csv "><code class="language-csv" data-lang="csv">id,title,images
1,dining room table,image1,image3,image2
</code></pre>
<p>Also Better:</p>
<pre data-lang="csv" class="language-csv "><code class="language-csv" data-lang="csv">id,title,images
1,dining room table,&quot;image1,image3,image2&quot;
</code></pre>
<p>Also also better:</p>
<pre data-lang="csv" class="language-csv "><code class="language-csv" data-lang="csv">id,title,image1,image2,image3,image4,image5
1,dining room table,image1,image3,image2,,
</code></pre>
<h2 id="one-file">One file</h2>
<p>Trust me, it's <em>much</em> easier to parse records when they're all in the same file and not spread out over, say, a &quot;data&quot; file, &quot;price&quot; file, and &quot;inventory level&quot; file.  All the data in one place.</p>
<h2 id="have-a-header">Have a header</h2>
<p>If there's no header, we don't know what your data is.</p>
<h2 id="have-the-header-be-the-first-line">Have the header be the first line</h2>
<p>If it's not the first line, it can be worked around in most cases, but that's additional customization, which introduces fragility.</p>
<h2 id="each-row-should-have-the-same-number-of-fields-as-the-header">Each row should have the same number of fields as the header</h2>
<p>Hopefully self-explanatory</p>
<p>Bad:</p>
<pre data-lang="csv" class="language-csv "><code class="language-csv" data-lang="csv">id,title,image
1,stuffed bear
</code></pre>
<p>Also Bad:</p>
<pre data-lang="csv" class="language-csv "><code class="language-csv" data-lang="csv">id,title,image
1,stuffed bear,image1,image2
</code></pre>
<p>Best:</p>
<pre data-lang="csv" class="language-csv "><code class="language-csv" data-lang="csv">id,title,image
1,stuffed bear,
2,table,image1
</code></pre>
<h2 id="delimiters">Delimiters</h2>
<p>Long story short, I don't care which one you use, but use one that's not used in your data.  For instance, if your data has commas, maybe don't use them as a field separator?</p>
<p>Bad:</p>
<pre data-lang="csv" class="language-csv "><code class="language-csv" data-lang="csv">testing,1,2,3,what are we having, adam, for lunch?
</code></pre>
<p>Best:</p>
<pre data-lang="csv" class="language-csv "><code class="language-csv" data-lang="csv">testing, 1, 2, 3|what are we having, adam, for lunch?
</code></pre>
<h2 id="quoting">Quoting</h2>
<p>If you <em>must</em> use a delimiter that your data also contains, quote the fields and be consistent.  Yes, I realize most csv parsers can handle some fields being quoted and others not, but it does make things a headache if something goes wrong.</p>
<p>For the love of everything that is holy, do NOT use smart quotes as delimiters!!!  Especially if you use smart quotes in your data!</p>
<p>Bad:</p>
<pre data-lang="csv" class="language-csv "><code class="language-csv" data-lang="csv">testing,1,2,3,what are we having, adam, for lunch?
</code></pre>
<p>So, so, so bad:</p>
<pre data-lang="csv" class="language-csv "><code class="language-csv" data-lang="csv">“testing,1,2”,3,“what are we having, adam, for lunch?”
</code></pre>
<p>Better:</p>
<pre data-lang="csv" class="language-csv "><code class="language-csv" data-lang="csv">&quot;testing,1,2&quot;,3,&quot;what are we having, adam, for lunch?&quot;
</code></pre>
<p>Best:</p>
<pre data-lang="csv" class="language-csv "><code class="language-csv" data-lang="csv">&quot;testing,1,2&quot;,&quot;3&quot;,&quot;what are we having, adam, for lunch?&quot;
</code></pre>
<h2 id="line-endings">Line Endings</h2>
<p>This is what determines where a new line/record starts.</p>
<p>Please please please use just <code>\n</code> for a line ending, <code>\r\n</code> works too.  If you must, use just <code>\r</code>.  Finally, don't mix them, please!</p>
<h2 id="encoding">Encoding</h2>
<p>It seems like the world is starting to standardize on UTF-8.  Means you should probably do the same.  Multiple encodings means the parser has to try the most common first, if that fails, try a fallback, etc.  This has both data quality and performance implications.  Neither of which you want.</p>
<h2 id="entire-data-set-vs-update">Entire Data Set vs. Update</h2>
<p>This gets into the weeds a bit, but providing all the data all the time is the easiest way to both provide and parse data.  It allows whomever you're sending the data to reprocess the entire dataset if something goes wrong.</p>
<p>That being said, if the data is truly immense (gigabytes or terabytes of data), I'd recommend an interval setup.  Basically every so often send the entire data set, and in the meantime, send only the records that have changed, BUT, send the entire record, not just the data in the record that changed.</p>
<h2 id="deletes">Deletes</h2>
<p>This is probably the hardest bit to handle.  I've seen two ways to handle it and both have their advantages and drawbacks.  In my experience, the &quot;Absence Indicates Delete&quot; tends to be less error prone as long as the consumer is handling unexpected source files appropriately.</p>
<p>For the engineers reading this, it's the difference between the transfer of an entire system of state (single file) vs. state with multiple inputs that can get out of sync (delete file).</p>
<h3 id="absence-indicates-delete">Absence Indicates Delete</h3>
<p>Basically if a record that already exists on the consumer of the csv isn't included in the provided csv it's deleted (or marked for delete or hidden, I'm treating these conditions the same for this post).</p>
<p>This has the advantage of not having to parse an additional file.</p>
<p>The disadvantage is that if either the csv file provided isn't what's expected or something goes wrong on the consumer side, an entire dataset can be deleted.</p>
<h3 id="delete-only-file">Delete-only File</h3>
<p>Essentially this file would be a list of the records to be deleted.</p>
<p>Has the advantage of being less error prone if the source csv is bad in some way.</p>
<p>The disadvantage here is twofold.  First, needing to provide and parse a second file with a different format than the standard data file.  Second, timing.  If the consumer sees both the data file and the delete file at the same time and a record is included in both, which one takes precedence?  Data or delete?  If a record has been deleted in the past and it's now seen in the data file, should it be created or ignored?</p>
<h2 id="summary">Summary</h2>
<p>So, what's the upshot of all this?  Similar to dealing with <a href="https://www.youtube.com/watch?v=-5wpm-gesOY">timezones</a>, don't build your own csv generator/parser.  Use one from someone that's already gone through all these headaches.  Stand on the shoulders of those giants.</p>
<p>If you're a product person reading this, my only advice to you is: listen to your engineers.  They know how hard dealing with csv files is and they're just trying to get the business result you want given the constraints they're operating under.</p>

          </div>
        </article>
      </div>
      
    </div>
  </div>
</section>


  
  <section class="modal" id="search-modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Search</p>
      </header>
      <section class="modal-card-body">
        <div class="field mb-2">
          <div class="control">
            <input class="input" id="search" placeholder="Search this website." type="search" />
          </div>
        </div>
        <div class="search-results">
          <div class="search-results__items"></div>
        </div>
      </section>
    </div>
    <button aria-label="close" class="modal-close is-large"></button>
  </section>
  


  

<section class="section">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <nav class="level">
          
          <div class="level-item has-text-centered">
            <a class="button is-black is-outlined" href="https:&#x2F;&#x2F;bryan-lott.github.io&#x2F;write-it-down-yo&#x2F;">
              <span class="icon mr-2">
                <i class="fas fa-arrow-circle-left"></i>
              </span>
              Write It Down Yo
            </a>
          </div>
           
          <div class="level-item has-text-centered">
            <a class="button is-black is-outlined" href="https:&#x2F;&#x2F;bryan-lott.github.io&#x2F;etl-tracers&#x2F;">
              ETL Tracers<span class="icon ml-2">
                <i class="fas fa-arrow-circle-right"></i>
              </span>
            </a>
          </div>
            
        </nav>
      </div>
    </div>
  </div>
</section>



  



  <footer class="footer py-4">
    <div class="content has-text-centered">
      <p>
        Built with
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-code"></i>
          </span>
          <span>code</span>
        </span>
        and
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-heart"></i>
          </span>
          <span>love</span>
        </span>
      </p>
      <p>
        Powered by
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-power-off"></i>
          </span>
          <span>zola</span>
        </span>
      </p>
    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/galleria@1.6.1/dist/galleria.min.js" integrity="sha384-QSfwGT8/EU536DKdtyP2D6SLlh8zBaZ0cVkwfrwhqzIU9VCfJT00CLVP5t+HAiYg" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/galleria@1.6.1/dist/themes/folio/galleria.folio.min.js" integrity="sha384-DwpKI+deZB267+hPKwiOIc5Y2GKsVL0mR6hgz7GgIu7AgAMYqJwcJKY1YBNfhWcY" crossorigin="anonymous"></script>
  
  
  <script src="https://cdn.jsdelivr.net/npm/mermaid@8.13.5/dist/mermaid.min.js" integrity="sha384-0yWn54pSGtfKCU+skfA69l25VsCw+MZt4LQov3xNRoS7YkAMrFokGgSBnAWSK4pv" crossorigin="anonymous"></script>
  
  
  <script src="https://cdn.jsdelivr.net/npm/chart.xkcd@1.1.13/dist/chart.xkcd.min.js" integrity="sha384-xC3h1+IHXK8seA+8KfT79Z4e0GPsznjXBoMa5nd8ooWKplPyXx92NOmljWxLC/cs" crossorigin="anonymous"></script>
  
  
  <script src="https://bryan-lott.github.io/elasticlunr.min.js"></script>
  <script src="https://bryan-lott.github.io/search_index.en.js"></script><script src="https://bryan-lott.github.io/js/site.js"></script>

  





  
  
</body>

</html>
